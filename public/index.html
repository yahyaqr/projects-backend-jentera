<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>RPM Data Table</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      .rotate-45 {
        --transform-rotate: 45deg;
        transform: rotate(45deg);
      }

      .group:hover .group-hover\:flex {
        display: flex;
      }

      .group:focus .group-focus\:flex {
        display: flex;
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <div>
      <div class="flex w-screen h-screen text-gray-400 bg-gray-900">
        <!-- Component Start -->
        <!-- Sidebar -->
        <div
          class="flex flex-col items-center w-16 pb-4 overflow-auto border-r border-gray-800 text-gray-500"
        >
          <a
            class="flex items-center justify-center flex-shrink-0 w-full h-16"
            href="#"
          >
            <svg
              class="w-8 h-8 stroke-current text-gray-300"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"
              />
            </svg>
          </a>
          <a
            class="flex items-center justify-center flex-shrink-0 w-10 h-10 mt-4 rounded hover:bg-gray-800"
            href="#"
          >
            <svg
              class="w-5 h-5"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
              />
            </svg>
          </a>
          <a
            class="flex items-center justify-center flex-shrink-0 w-10 h-10 mt-4 rounded hover:bg-gray-800"
            href="#"
          >
            <svg
              class="w-5 h-5"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
              />
            </svg>
          </a>
          <a
            class="flex items-center justify-center flex-shrink-0 w-10 h-10 mt-4 rounded hover:bg-gray-800"
            href="#"
          >
            <svg
              class="w-5 h-5"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"
              />
            </svg>
          </a>
          <a
            class="flex items-center justify-center flex-shrink-0 w-10 h-10 mt-4 rounded hover:bg-gray-800"
            href="#"
          >
            <svg
              class="w-5 h-5"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
              />
            </svg>
          </a>
          <a
            class="flex items-center justify-center flex-shrink-0 w-10 h-10 mt-4 rounded hover:bg-gray-800"
            href="#"
          >
            <svg
              class="w-5 h-5"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"
              />
            </svg>
          </a>
          <a
            class="flex items-center justify-center flex-shrink-0 w-10 h-10 mt-4 mt-auto rounded hover:bg-gray-800"
            href="#"
          >
            <svg
              class="w-5 h-5"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
          </a>
        </div>
        <!-- Sub sidebar -->
        <div class="flex flex-col w-56 border-r border-gray-800">
          <!-- Dropdown sidebar -->
          <button class="relative text-sm focus:outline-none group">
            <div
              class="flex items-center justify-between w-full h-16 px-4 border-b border-gray-800 hover:bg-gray-800"
            >
              <span class="font-medium"> Dropdown </span>
              <svg
                class="w-4 h-4"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
            <div
              class="absolute z-10 flex-col items-start hidden w-full pb-1 bg-gray-800 shadow-lg group-focus:flex"
            >
              <a class="w-full px-4 py-2 text-left hover:bg-gray-900" href="#"
                >Menu Item 1</a
              >
              <a class="w-full px-4 py-2 text-left hover:bg-gray-900" href="#"
                >Menu Item 1</a
              >
              <a class="w-full px-4 py-2 text-left hover:bg-gray-900" href="#"
                >Menu Item 1</a
              >
            </div>
          </button>
          <!-- Navigation sidebar -->
          <div class="flex flex-col flex-grow p-4 overflow-auto">
            <a
              class="flex items-center flex-shrink-0 h-10 px-2 text-sm font-medium rounded hover:bg-gray-800"
              href="#"
            >
              <span class="leading-none">Device J01</span>
            </a>
            <a
              class="flex items-center flex-shrink-0 h-10 px-2 text-sm font-medium rounded hover:bg-gray-800"
              href="#"
            >
              <span class="leading-none">Device J02</span>
            </a>
            <a
              class="flex items-center flex-shrink-0 h-10 px-2 text-sm font-medium rounded hover:bg-gray-800"
              href="#"
            >
              <span class="leading-none">Device J03</span>
            </a>
            <a
              class="flex items-center flex-shrink-0 h-10 px-2 text-sm font-medium rounded hover:bg-gray-800"
              href="#"
            >
              <span class="leading-none">Device J04</span>
            </a>
            <a
              class="flex items-center flex-shrink-0 h-10 px-2 text-sm font-medium rounded hover:bg-gray-800"
              href="#"
            >
              <span class="leading-none">Device J05</span>
            </a>
            <a
              class="flex items-center flex-shrink-0 h-10 px-2 text-sm font-medium rounded hover:bg-gray-800"
              href="#"
            >
              <span class="leading-none">Device J06</span>
            </a>
            <a
              class="flex items-center flex-shrink-0 h-10 px-3 mt-auto text-sm font-medium bg-gray-800 rounded hover:bg-gray-700"
              href="#"
            >
              <svg
                class="w-5 h-5"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 6v6m0 0v6m0-6h6m-6 0H6"
                />
              </svg>
              <span class="ml-2 leading-none">New Item</span>
            </a>
          </div>
        </div>
        <div class="flex flex-col flex-grow">
          <!-- Page Header -->
          <div
            class="flex items-center flex-shrink-0 h-16 px-8 border-b border-gray-800"
          >
            <h1 class="text-lg font-medium">Device J01</h1>
            <button
              class="flex items-center justify-center h-10 px-4 ml-auto text-sm font-medium rounded hover:bg-gray-800"
            >
              Monitor: OFF
            </button>
            <button
              class="flex items-center justify-center h-10 px-4 ml-2 text-sm font-medium bg-gray-800 rounded hover:bg-gray-700"
            >
              Sensor: ON
            </button>
            <button class="relative ml-2 text-sm focus:outline-none group">
              <div
                class="flex items-center justify-between w-10 h-10 rounded hover:bg-gray-800"
              >
                <svg
                  class="w-5 h-5 mx-auto"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"
                  />
                </svg>
              </div>
              <div
                class="absolute right-0 flex-col items-start hidden w-40 mt-1 pb-1 bg-gray-800 border border-gray-800 shadow-lg group-focus:flex"
              >
                <a class="w-full px-4 py-2 text-left hover:bg-gray-900" href="#"
                  >Menu Item 1</a
                >
                <a class="w-full px-4 py-2 text-left hover:bg-gray-900" href="#"
                  >Menu Item 2</a
                >
                <a class="w-full px-4 py-2 text-left hover:bg-gray-900" href="#"
                  >Menu Item 3</a
                >
              </div>
            </button>
          </div>
          <!-- Page Content -->
          <div class="flex-grow p-6 overflow-auto bg-gray-800">
            <div class="grid grid-cols-3 gap-6">
              <div class="h-24 col-span-3 bg-gray-700 h-auto overflow-hidden">
                <div class="p-6">
                  <canvas id="myChart"></canvas>
                  <script>
                    function fetchRPMDataByDeviceId(deviceId, chartId) {
                      fetch(`/data/RPM/${deviceId}`)
                        .then((rawResponse) => rawResponse.json())
                        .then((response) => {
                          const data = response.data.rpm;
                          console.log(data);

                          // Prepare data for Chart.js
                          const datasets = [
                            {
                              label: 'RPM Data',
                              data: data.map((item) => ({
                                x: new Date(item.timestamp).toLocaleString(
                                  'en-US',
                                  {
                                    month: 'numeric',
                                    day: 'numeric',
                                    hour: 'numeric',
                                    minute: 'numeric',
                                    hour12: false,
                                  },
                                ),
                                y: item.rpm,
                              })),
                              borderColor: 'rgb(75, 192, 192)',
                              tension: 0.1,
                            },
                          ];

                          // Create the chart
                          const ctx = document
                            .getElementById(chartId)
                            .getContext('2d');
                          new Chart(ctx, {
                            type: 'line',
                            data: {
                              datasets: datasets,
                            },
                            options: {
                              responsive: true,
                              scales: {
                                x: {
                                  ticks: {
                                    color: '#9CA3AF',
                                  },
                                },
                                y: {
                                  ticks: {
                                    beginAtZero: true,
                                    color: '#9CA3AF',
                                  },
                                },
                              },
                            },
                          });
                        })
                        .catch((error) => console.error(error));
                    }

                    fetchRPMDataByDeviceId('J01', 'myChart');
                  </script>
                </div>
              </div>
              <div class="h-24 col-span-3 bg-gray-700 h-60 overflow-y-scroll">
                <div class="p-6 flex flex-row">
                  <table id="rpm-data-table" class="table-auto w-full">
                    <thead>
                      <tr>
                        <th class="px-4 py-2 border">Timestamp</th>
                        <th class="px-4 py-2 border">Device ID</th>
                        <th class="px-4 py-2 border">RPM</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                  <script>
                    function fetchRPMData() {
                      fetch('/data/RPM')
                        .then((rawResponse) => rawResponse.json())
                        .then((response) => {
                          const tableBody = document.querySelector(
                            '#rpm-data-table tbody',
                          );
                          tableBody.innerHTML = '';
                          response.data.rpm.forEach((item) => {
                            const row = tableBody.insertRow();
                            const cell1 = row.insertCell();
                            cell1.textContent = new Date(
                              item.timestamp,
                            ).toLocaleString('en-US', {
                              month: 'numeric',
                              day: 'numeric',
                              hour: 'numeric',
                              minute: 'numeric',
                              hour12: false,
                            });
                            cell1.classList.add('border', 'p-2'); // Add border classes to cell1
                            const cell2 = row.insertCell();
                            cell2.textContent = item.deviceId;
                            cell2.classList.add('border', 'p-2'); // Add border classes to cell2
                            const cell3 = row.insertCell();
                            cell3.textContent = item.rpm;
                            cell3.classList.add('border', 'p-2'); // Add border classes to cell3
                          });
                        })
                        .catch((error) => console.error(error));
                    }
                  </script>
                </div>
              </div>
              <div class="h-24 col-span-1 bg-gray-700 h-auto">
                <div class="p-6 flex flex-row">
                  <div class="flex flex-col flex-grow">
                    <h1 class="text-xl font-bold mb-4">Add Single Datapoint</h1>
                    <input
                      class="w-full px-4 py-2 mb-2 border rounded"
                      type="datetime-local"
                      id="startTimestamp"
                      name="startTimestamp"
                      required
                    />
                    <select
                      id="device-input"
                      class="rounded-md py-2 px-4 mt-4 mb-2 border border-gray-400"
                    >
                      <option value="J01">J01</option>
                      <option value="J02">J02</option>
                      <option value="J03">J03</option>
                      <option value="J04">J04</option>
                    </select>
                    <input
                      type="number"
                      id="rpm-input"
                      placeholder="RPM"
                      class="rounded-md py-2 px-4 mt-4 mb-2 border border-gray-400"
                    />
                    <button
                      id="add-button"
                      class="rounded-md py-2 px-4 mt-4 text-white bg-blue-500 hover:bg-blue-700"
                    >
                      Add
                    </button>
                    <script>
                      async function addRPMData() {
                        const deviceInput =
                          document.querySelector('#device-input');
                        const rpmInput = document.querySelector('#rpm-input');

                        try {
                          const response = await fetch('/data/RPM', {
                            method: 'POST',
                            headers: {
                              'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                              deviceId: deviceInput.value,
                              rpm: rpmInput.value,
                            }),
                          });

                          if (!response.ok) {
                            throw new Error('Gagal menambahkan data RPM');
                          }

                          deviceInput.value = '';
                          rpmInput.value = '';
                          fetchRPMData();
                        } catch (error) {
                          console.error(error);
                        }
                      }

                      document.addEventListener('DOMContentLoaded', () => {
                        fetchRPMData();
                        const addButton = document.querySelector('#add-button');
                        addButton.addEventListener('click', addRPMData);
                      });
                    </script>
                  </div>
                </div>
              </div>
              <div class="h-24 col-span-2 bg-gray-700 h-auto">
                <div class="p-6">
                  <div class="flex flex-row">
                    <h1 class="text-xl font-bold mb-4">Generate Datapoints</h1>
                  </div>
                  <div class="flex flex-row gap-4">
                    <div class="flex flex-col flex-1">
                      <label class="block mb-2" for="startTimestamp"
                        >Timestamp start:</label
                      >
                      <input
                        class="w-full px-4 py-2 border rounded"
                        type="datetime-local"
                        id="startTimestamp"
                        name="startTimestamp"
                        required
                      />
                      <label class="block mt-4 mb-2" for="interval"
                        >Timestamp interval:</label
                      >
                      <input
                        class="w-full px-4 py-2 border rounded"
                        type="number"
                        id="interval"
                        name="interval"
                        required
                      />
                    </div>
                    <div class="flex flex-col flex-1">
                      <label class="block mb-2" for="deviceId"
                        >Device ID:</label
                      >
                      <select
                        class="w-full px-4 py-2 border rounded"
                        id="deviceId"
                        name="deviceId"
                        required
                      >
                        <option value="device1">Device 1</option>
                        <option value="device2">Device 2</option>
                        <option value="device3">Device 3</option>
                      </select>
                      <label class="block mt-4 mb-2" for="numberOfDatapoints"
                        ># of Datapoints:</label
                      >
                      <input
                        class="w-full px-4 py-2 border rounded"
                        type="number"
                        id="numberOfDatapoints"
                        name="numberOfDatapoints"
                        required
                      />
                    </div>
                  </div>
                  <div class="flex flex-row">
                    <div class="flex flex-col flex-1 mt-6">
                      <input
                        class="bg-blue-500 text-white px-4 py-2 rounded cursor-pointer"
                        type="submit"
                        value="Generate"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Component End  -->
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </body>
</html>
